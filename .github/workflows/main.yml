name: CI
on: 
  push: 
    branches:
      - main
  pull_request:
    branches:
      - main
  
jobs:
  push:
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    env: 
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
    
    steps:
    - uses: actions/checkout@v4
    - name: instalando dependencias
      run: pip install -r requirements.txt
    - name: ejecutando pruebas
      run: python manage.py test
    - name: deploy
      run: curl -X POST ${{ secrets.RENDER_DEPLOY_KEY }}
    - uses: act10ns/slack@v2
      with:
        channel: '#todo-feedback-ci'
        status: ${{job.status}}
        steps: ${{toJson(steps)}}
      if: always()
  
  pull_r:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    env: 
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
    
    steps:
    - uses: actions/checkout@v4
    - name: instalando dependencias
      run: pip install -r requirements.txt
    - name: ejecutando pruebas
      run: python manage.py test
      
